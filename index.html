<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SKのBlog - King</title><meta name="description" content="What doesn&#39;t kill you makes you stronger."><meta name="keywords" content="SK,iOS,Swift"><meta name="author" content="SK Wang"><meta name="copyright" content="SK Wang"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/favicon.png"><link rel="canonical" href="https://shoukaiwang.github.io/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="website"><meta property="og:title" content="SKのBlog"><meta property="og:url" content="https://shoukaiwang.github.io/"><meta property="og:site_name" content="SKのBlog"><meta property="og:description" content="What doesn&#39;t kill you makes you stronger."><meta property="og:image" content="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/avatar.jpeg"><meta property="article:published_time" content="2020-07-23T06:02:10.065Z"><meta property="article:modified_time" content="2020-07-23T06:02:10.065Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isSidebar: false
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="SKのBlog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/avatar.jpeg" onerror="onerror=null;src='/img/favicon.png'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">7</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">4</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="full_page" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000054.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">SKのBlog</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="site-info"><h1 id="site_title">SKのBlog</h1><div id="site_subtitle"><span id="subtitle"></span></div><div id="site_social_icons"><a class="social-icon" href="https://github.com/ShoukaiWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:shoukaiwang@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div id="scroll_down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout_page" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="post_cover left_radius"><a href="/posts/16107/" title="Hello World">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000047.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/16107/" title="Hello World">Hello World</a><div class="article-meta-wrap"><span class="article-meta"><i class="fas fa-thumbtack article-meta__icon sticky"></i><span class="sticky">Sticky</span><span class="article-meta__separator">|</span></span><time class="post-meta__date" title="Created 2020-07-23 13:53:25"><i class="far fa-calendar-alt"></i>2020-07-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/hexo/">hexo</a></span></div><div class="content">Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub.
Quick StartCreate a new post1$ hexo new "My New Post"

More info: Writing
Run server1$ hexo server

More info: Server
Generate static files1$ hexo generate

More info: Generating
Deploy to remote sites1$ hexo deploy

More info: Deployment

        document.querySelectorAll('.github-emoji')
          .for ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/posts/ecffcb82/" title="OpenGL的渲染技巧-正背面剔除">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200223.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL的渲染技巧-正背面剔除"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/ecffcb82/" title="OpenGL的渲染技巧-正背面剔除">OpenGL的渲染技巧-正背面剔除</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-20 10:07:40"><i class="far fa-calendar-alt"></i>2020-07-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span></div><div class="content">今天通过一个小案例，来讲解OpenGL的正背面剔除以及深度测试的应用。
圆环的绘制我们使用GLTools中的void gltMakeTorus(GLTriangleBatch&amp; torusBatch, GLfloat majorRadius, GLfloat minorRadius, GLint numMajor, GLint numMinor)方法，简单实现一下圆环的绘制。
代码实现123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687////  main.cpp//  OpenGLDemo////  Created by SK on 2020/7/3.//  Copyright © 2020 SK. All rights reserved.//#include "GLShaderManager.h"#i ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/posts/2d6c78da/" title="探寻autoreleasepool">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200228.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻autoreleasepool"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/2d6c78da/" title="探寻autoreleasepool">探寻autoreleasepool</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-12 00:52:37"><i class="far fa-calendar-alt"></i>2020-07-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">底层结构12345int main(int argc, const char * argv[]) {    @autoreleasepool {    }    return 0;}
我们通过执行xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc -fno-objc-arc  main.m，将上述代码转换成C++
123456789101112131415struct __AtAutoreleasePool {  __AtAutoreleasePool() {      atautoreleasepoolobj = objc_autoreleasePoolPush();  }  ~__AtAutoreleasePool() {      objc_autoreleasePoolPop(atautoreleasepoolobj);  }  void * atautoreleasepoolobj;};int main(int argc, const char * argv[]) {    /* @autoreleasepool */ {  ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/posts/303a73ce/" title="iOS中离屏渲染探索">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="iOS中离屏渲染探索"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/303a73ce/" title="iOS中离屏渲染探索">iOS中离屏渲染探索</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-11 11:37:51"><i class="far fa-calendar-alt"></i>2020-07-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span></div><div class="content">什么是离屏渲染？离屏渲染（offscreen-rendering）顾名思义为屏幕外的渲染，即渲染的结果不会直接呈现到当前屏幕上，而是等待合适的时机才会被显示。
正常情况下，在当前屏幕显示的内容，由 GPU 渲染完成后放到当前屏幕的帧缓存区，不需要额外的渲染空间。
假如 GPU 因为面临一些限制，无法把渲染结果直接写入frame buffer，而是先暂存在另外的内存区域，之后再写入frame buffer，那么这个过程被称之为离屏渲染。
离屏渲染的过程通常的渲染流程是这样的
在正常情况下，经过CPU的计算以及GPU的渲染之后，不停地将内容渲染完成放入Frame Buffer中帧缓存区，随后视频控制器会读取帧缓存区的数据，经过数模转换，再逐行显示到屏幕上
出现离屏渲染的渲染流程：
与普通情况下 GPU 直接将渲染好的内容放入Frame Buffer中不同，在某些特殊情况下，需要先额外创建离屏渲染缓冲区 offscreen Buffer，将提前渲染好的内容放入其中，等到合适的时机再将 offscreen Buffer 中的内容进一步叠加、渲染，最后将结果切换到 Frame Buffer 中。 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/posts/6322cf7d/" title="探寻iOS多线程">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200237.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻iOS多线程"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/6322cf7d/" title="探寻iOS多线程">探寻iOS多线程</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-10 15:15:25"><i class="far fa-calendar-alt"></i>2020-07-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">iOS中的常见多线程方案
GCDGCD中有2个用来执行任务的函数

用同步的方式执行任务dispatch_sync(dispatch_queue_t queue, dispatch_block_t block);
用异步的方式执行任务dispatch_async(dispatch_queue_t queue, dispatch_block_t block);

GCD源码：https://github.com/apple/swift-corelibs-libdispatch
GCD的队列GCD的队列可以分为2大类型

并发队列（Concurrent Dispatch Queue）可以让多个任务并发执行（自动开启多个线程同时执行任务）并发功能只有在异步函数下才有效
串行队列（Serial Dispatch Queue）让任务一个接着一个地执行

同步和异步主要影响：能不能开启新的线程同步：在当前线程中执行任务，不具备开启新线程的能力异步：在新的线程中执行任务，具备开启新线程的能力
并发和串行主要影响：任务的执行方式并发：多个任务并发执行串行：一个任务执行完毕后，再执行下一个任务

使用s ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/posts/66966108/" title="探寻runLoop">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000034.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻runLoop"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/66966108/" title="探寻runLoop">探寻runLoop</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-10 11:44:26"><i class="far fa-calendar-alt"></i>2020-07-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">顾名思义，RunLoop就是运行循环，在程序运行过程中循环做一些事情。应用的一些场景：

定时器（Timer）、PerformSelector
GCD Async Main Queue
事件响应、手势识别、界面刷新
网络请求
AutoreleasePool
控制线程生命周期（线程保活）
监控应用卡顿
性能优化

iOS中有2套API来访问和使用RunLoop

Foundation：NSRunLoop
Core Foundation：CFRunLoopRef

NSRunLoop和CFRunLoopRef都代表着RunLoop对象，NSRunLoop是基于CFRunLoopRef的一层OC包装，CFRunLoopRef是开源的https://opensource.apple.com/tarballs/CF/
RunLoop与线程
每条线程都有唯一的一个与之对应的RunLoop对象
RunLoop保存在一个全局的Dictionary里，线程作为key，RunLoop作为value
线程刚创建时并没有RunLoop对象，RunLoop会在第一次获取它时创建
RunLoop会在线程结束时销毁 ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/posts/d97e40db/" title="探寻block">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000037.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻block"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/d97e40db/" title="探寻block">探寻block</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-09 16:28:06"><i class="far fa-calendar-alt"></i>2020-07-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">block的本质block本质上也是一个OC对象，它内部也有个isa指针。block是封装了函数调用以及函数调用环境的OC对象。
12345678910111213141516171819202122232425262728293031323334////  Created by SK on 2020/7/7.//  Copyright © 2020 SK. All rights reserved.//#import &lt;Foundation/Foundation.h&gt;#import "Person.h"NSString *name = @"jack";int main(int argc, const char * argv[]) {    @autoreleasepool {        int age = 20;        static int sex = 0;        Person *person1 = [[Person alloc] init];        Person *person2 = [[Person alloc] init];         ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/posts/d1292c0e/" title="OpenGL-正方形绘制&amp;键位控制">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000040.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenGL-正方形绘制&amp;键位控制"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/d1292c0e/" title="OpenGL-正方形绘制&amp;键位控制">OpenGL-正方形绘制&amp;键位控制</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-08 20:07:04"><i class="far fa-calendar-alt"></i>2020-07-08</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OpenGL/">OpenGL</a></span></div><div class="content">前言今天使用OpenGL的固定存储着色器渲染正方形，并能通过键盘移动。效果如下：
正方形绘制流程
代码实现：123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129////  main.cpp//  OpenGLDemo////  Created by SK on 2020/7/3.//  Copyright © 2020 SK. All rights reserved.//#include "GLShaderManager.h"#include "GLTools.h"#include &lt ...</div></div></div><div class="recent-post-item"><div class="post_cover left_radius"><a href="/posts/1d04a2cc/" title="探寻OC关联对象">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻OC关联对象"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/1d04a2cc/" title="探寻OC关联对象">探寻OC关联对象</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-07 23:10:42"><i class="far fa-calendar-alt"></i>2020-07-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">简单应用关联对象常用的API如下：
1234void objc_setAssociatedObject(id object, const void * key,                                id value, objc_AssociationPolicy policy)id objc_getAssociatedObject(id object, const void * key)void objc_removeAssociatedObjects(id object)
默认情况下，因为分类底层结构的限制，不能添加成员变量到分类中。但可以通过关联对象来间接实现。
123456789101112131415@interface Person (Extension)@property (copy, nonatomic) NSString *name;@end@implementation Person (Extension)- (void)setName:(NSString *)name {    objc_setAssociatedObject(self,  ...</div></div></div><div class="recent-post-item"><div class="post_cover right_radius"><a href="/posts/b68ef59d/" title="探寻Category">     <img class="post_bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200231.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="探寻Category"></a></div><div class="recent-post-info"><a class="article-title" href="/posts/b68ef59d/" title="探寻Category">探寻Category</a><div class="article-meta-wrap"><time class="post-meta__date" title="Created 2020-07-07 21:09:11"><i class="far fa-calendar-alt"></i>2020-07-07</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fas fa-inbox article-meta__icon"></i><a class="article-meta__categories" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/">OC底层原理</a></span></div><div class="content">Category的底层结构在源码的中，我们可以查看到Category的底层结构（objc-runtime-new.h）
12345678910111213141516171819202122struct category_t {    const char *name;    classref_t cls;    struct method_list_t *instanceMethods;    struct method_list_t *classMethods;    struct protocol_list_t *protocols;    struct property_list_t *instanceProperties;    // Fields below this point are not always present on disk.    struct property_list_t *_classProperties;    method_list_t *methodsForMeta(bool isMeta) {        if (isMeta) retur ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/avatar.jpeg" onerror="this.onerror=null;this.src='/img/favicon.png'" alt="avatar"/><div class="author-info__name">SK Wang</div><div class="author-info__description">What doesn't kill you makes you stronger.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives"><div class="headline">Articles</div><div class="length_num">40</div></a></div><div class="card-info-data-item is-center">      <a href="/tags"><div class="headline">Tags</div><div class="length_num">7</div></a></div><div class="card-info-data-item is-center">     <a href="/categories"><div class="headline">Categories</div><div class="length_num">4</div></a></div></div><div class="card-info-bookmark is-center"><button class="button--animated" id="bookmark-it" title="Bookmark"><i class="fas fa-bookmark"></i><span>Bookmark</span></button></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ShoukaiWang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:shoukaiwang@foxmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-recent-item"><div class="aside-recent-post"><a href="/posts/16107/"><div class="aside-post-cover"><img class="aside-post-bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000047.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" title="Hello World" alt="Hello World"/></div><div class="aside-post-title"><div class="aside-post_title" href="/posts/16107/" title="Hello World">Hello World</div><time class="aside-post_meta post-meta__date" title="Created 2020-07-23 13:53:25">2020-07-23</time></div></a></div><div class="aside-recent-post"><a href="/posts/ecffcb82/"><div class="aside-post-cover"><img class="aside-post-bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200223.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" title="OpenGL的渲染技巧-正背面剔除" alt="OpenGL的渲染技巧-正背面剔除"/></div><div class="aside-post-title"><div class="aside-post_title" href="/posts/ecffcb82/" title="OpenGL的渲染技巧-正背面剔除">OpenGL的渲染技巧-正背面剔除</div><time class="aside-post_meta post-meta__date" title="Created 2020-07-20 10:07:40">2020-07-20</time></div></a></div><div class="aside-recent-post"><a href="/posts/2d6c78da/"><div class="aside-post-cover"><img class="aside-post-bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200228.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" title="探寻autoreleasepool" alt="探寻autoreleasepool"/></div><div class="aside-post-title"><div class="aside-post_title" href="/posts/2d6c78da/" title="探寻autoreleasepool">探寻autoreleasepool</div><time class="aside-post_meta post-meta__date" title="Created 2020-07-12 00:52:37">2020-07-12</time></div></a></div><div class="aside-recent-post"><a href="/posts/303a73ce/"><div class="aside-post-cover"><img class="aside-post-bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" title="iOS中离屏渲染探索" alt="iOS中离屏渲染探索"/></div><div class="aside-post-title"><div class="aside-post_title" href="/posts/303a73ce/" title="iOS中离屏渲染探索">iOS中离屏渲染探索</div><time class="aside-post_meta post-meta__date" title="Created 2020-07-11 11:37:51">2020-07-11</time></div></a></div><div class="aside-recent-post"><a href="/posts/6322cf7d/"><div class="aside-post-cover"><img class="aside-post-bg" data-src="medias/loading.gif" data-original="https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722200237.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" title="探寻iOS多线程" alt="探寻iOS多线程"/></div><div class="aside-post-title"><div class="aside-post_title" href="/posts/6322cf7d/" title="探寻iOS多线程">探寻iOS多线程</div><time class="aside-post_meta post-meta__date" title="Created 2020-07-10 15:15:25">2020-07-10</time></div></a></div></div></div></div><div class="card-widget card-categories"><div class="card-content"><div class="item-headline"><i class="fas fa-folder-open"></i><span>Categories</span></div><ul class="card-category-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/DataStructures-Algorithms/"><span class="card-category-list-name">DataStructures & Algorithms</span><span class="card-category-list-count">27</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OC%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"><span class="card-category-list-name">OC底层原理</span><span class="card-category-list-count">8</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/OpenGL/"><span class="card-category-list-name">OpenGL</span><span class="card-category-list-count">4</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/hexo/"><span class="card-category-list-name">hexo</span><span class="card-category-list-count">1</span></a></li>
                       
            </ul></div></div><div class="card-widget card-tags"><div class="card-content"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/Algorithms/" style="font-size: 20.5px; color: #99a5b6">Algorithms</a> <a href="/tags/C/" style="font-size: 22px; color: #99a9bf">C</a> <a href="/tags/C/" style="font-size: 19px; color: #99a1ac">C++</a> <a href="/tags/Objective-C/" style="font-size: 19px; color: #99a1ac">Objective-C</a> <a href="/tags/OpenGL/" style="font-size: 17.5px; color: #999da3">OpenGL</a> <a href="/tags/hexo/" style="font-size: 16px; color: #999">hexo</a> <a href="/tags/runloop/" style="font-size: 16px; color: #999">runloop</a></div></div></div><div class="card-widget card-archives"><div class="card-content"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/07/"><span class="card-archive-list-date">July 2020</span><span class="card-archive-list-count">12</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/05/"><span class="card-archive-list-date">May 2020</span><span class="card-archive-list-count">9</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/04/"><span class="card-archive-list-date">April 2020</span><span class="card-archive-list-count">18</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/03/"><span class="card-archive-list-date">March 2020</span><span class="card-archive-list-count">1</span></a></li></ul></div></div><div class="card-widget card-webinfo"><div class="card-content"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="webinfo-article-name">Article :</div><div class="webinfo-article-count">40</div></div><div class="webinfo-item">      <div class="webinfo-site-uv-name">UV :</div><div class="webinfo-site-uv-count" id="busuanzi_value_site_uv"></div></div><div class="webinfo-item"><div class="webinfo-site-name">PV :</div><div class="webinfo-site-pv-count" id="busuanzi_value_site_pv"></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/ShoukaiWang/CDN@master/img/20200722000054.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 By SK Wang</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">King</div><div class="icp"><a><img class="icp-icon" src="medias/loading.gif" data-original="/img/icp.png"/><span></span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button class="translate_chn_to_cht" id="translateLink" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="Setting"><i class="fas fa-cog"></i></button><button id="go-up" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="canvas_nest" color="255,0,0" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/js/third-party/canvas-nest.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/npm/typed.js"></script><script>var subtitleEffect = true
if (subtitleEffect) { 
  var typed = new Typed("#subtitle", {
    strings: "Never put off till tomorrow what you can do today,What doesn't kill you makes you stronger.".split(","),
    startDelay: 300,
    typeSpeed: 150,
    loop: true,
    backSpeed: 50
  })
} else {
  document.getElementById("subtitle").innerHTML = 'Never put off till tomorrow what you can do today'
}</script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,e,a=0;a<r.length;a++)t=r[a],e=void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/miku.model.json"},"display":{"superSample":2,"position":"left","width":150,"height":300},"mobile":{"show":true,"scale":1},"react":{"opacityDefault":0.3,"opacityOnHover":0.3,"opacity":0.95},"log":false});</script></body></html>